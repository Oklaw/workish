<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workish ‚Äî Wallet</title>
  <meta name="description" content="Workish Wallet: Build habits, grow savings, learn real-world money skills."/>
  <meta name="geo.region" content="US-VA">
  <meta name="geo.placename" content="Northern Virginia">

  <style>
    :root{
      /* Match your site variables exactly */
      --forest:#003924;
      --ink:#0f2a1b;
      --sub:#224E3B;
      --cream:#F7F3EA;
      --off:#FAF8F2;
      --gold:#FFD66B;
      --line:rgba(0,0,0,.14);
      --font:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      --r-sm:14px; --r-lg:24px;
      --shadow:0 10px 24px rgba(0,0,0,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--ink); background:var(--cream);
      -webkit-font-smoothing:antialiased;
    }

    /* Background image + soft overlay (kept consistent) */
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:url("/images/customer.PNG") center/cover no-repeat;
      filter:brightness(.96) saturate(1.02) blur(.3px);
    }
    body::after{
      content:""; position:fixed; inset:0; z-index:-1;
      background:linear-gradient(180deg,
        rgba(0,57,36,.30) 0px,
        rgba(0,57,36,.24) 280px,
        rgba(247,243,234,.18) 60%,
        rgba(247,243,234,.22) 100%);
      pointer-events:none;
    }

    /* ===== Header (identical shell) ===== */
    .site-header{ position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--line); }
    .nav-wrap{ height:84px; display:flex; align-items:center; gap:18px; max-width:1100px; margin:0 auto; padding:0 16px; }
    .nav-brand{ display:flex; align-items:center; text-decoration:none; }
    .nav-logo { max-height:86px; width:auto; display:block; object-fit:contain; }
    .nav-main{ display:flex; align-items:center; gap:6px; margin-left:8px; }
    .nav-item{ position:relative; }
    .nav-link{ background:transparent; border:none; cursor:pointer; padding:10px 12px; border-radius:10px; font-weight:700; color:#0e1f17; }
    .submenu{ position:absolute; top:100%; left:0; min-width:220px; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 12px 28px rgba(0,0,0,.12); padding:8px; display:none; }
    .submenu a{ display:block; padding:10px 12px; border-radius:8px; color:#224E3B; text-decoration:none; font-weight:600; }
    .submenu a:hover{ background:var(--off); }
    @media(hover:hover){ .has-submenu:hover .submenu{ display:block; } }
    .nav-burger{ margin-left:auto; width:42px; height:42px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff; display:none; align-items:center; justify-content:center; gap:4px; flex-direction:column; cursor:pointer; }
    .nav-burger span{ width:20px; height:2px; background:#0e1f17; display:block; }
    .mobile-panel{ border-top:1px solid var(--line); background:#fff; box-shadow:0 12px 28px rgba(0,0,0,.12); }
    .m-item{ border-bottom:1px solid var(--line); padding:6px 8px; }
    .m-item summary{ cursor:pointer; padding:12px 8px; font-weight:800; }
    .m-item a{ display:block; padding:10px 12px; text-decoration:none; color:#224E3B; }
    .m-item a:hover{ background:var(--off); border-radius:8px; }
    @media(max-width:900px){ .nav-main{display:none;} .nav-burger{display:flex;} }

    /* ===== Page shell ===== */
    .shell{ max-width:1100px; margin:0 auto; padding:28px 16px 88px; }

    .hero{
      display:flex; flex-direction:column; gap:10px;
      margin-bottom:32px;
      color:#fff; text-shadow:0 3px 6px rgba(0,0,0,.40);
    }
    .hero h1{ margin:0; font-size:clamp(26px,4.6vw,42px); line-height:1.12; letter-spacing:-.02em; color:#fff; font-weight:900; }
    .hero p{ margin:0; color:#ffffff; font-weight:600; font-size:1.05rem; }
    .cta-row{ display:flex; gap:10px; flex-wrap:wrap; }
    .apply{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 22px; border-radius:999px; background:var(--forest); color:#fff;
      font-weight:900; text-decoration:none; font-size:1.05rem;
      border:2px solid #fff; box-shadow:0 0 8px rgba(255,255,255,.35), 0 8px 24px rgba(0,0,0,.25);
      transition:transform .12s ease, filter .2s ease; margin-top:8px;
    }
    .apply:hover{ filter:brightness(1.08); transform:translateY(-2px); }
    /* Equal width CTAs */
    .cta-row .apply{ flex:1 1 280px; text-align:center; }

    .grid{ display:grid; gap:18px; grid-template-columns: 1.1fr 1fr; }
    @media(max-width:990px){ .grid{ grid-template-columns:1fr; } }

    .card{ background:#fff; border:1px solid var(--line); border-radius:var(--r-lg); box-shadow:var(--shadow); padding:14px; }
    .card h3{ margin:0 0 8px; font-size:1.08rem; }

    /* Wallet Components ‚Äî styled to match */
    .balances{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:8px; }
    @media(max-width:720px){ .balances{grid-template-columns:repeat(2,1fr);} }
    .kpi{ background:linear-gradient(180deg,#fff,#f7fbf8); border:1px solid var(--line); border-radius:14px; padding:12px; }
    .kpi .label{ font-size:.82rem; color:#4c5e55; }
    .kpi .val{ font-weight:900; font-size:1.35rem; color:var(--forest); }
    .kpi .sub{ font-size:.78rem; color:#6c7b75; }

    .level{ display:flex; align-items:center; gap:10px; margin-top:12px; }
    .level .barwrap{ flex:1; background:#ecf2ee; border-radius:999px; height:10px; overflow:hidden }
    .level .bar{ height:100%; width:0; background:linear-gradient(90deg,var(--gold),#f0b500) }
    .level .num{ font-weight:900; color:#7a5a00 }

    .goals{ display:grid; grid-template-columns:1fr; gap:10px }
    @media(min-width:560px){ .goals{ grid-template-columns:1fr 1fr } }
    .goal{ border:1px dashed rgba(0,0,0,.15); border-radius:14px; padding:12px; position:relative }
    .goal .top{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .goal .name{ font-weight:800 }
    .progress{ height:10px; background:#eef3f0; border-radius:999px; overflow:hidden; margin-top:10px }
    .bar{ height:100%; width:0; background:linear-gradient(90deg, var(--forest), #0f6b42) }
    .goal .meta{ font-size:.8rem; color:#51635b; margin-top:6px; display:flex; justify-content:space-between }
    .goal .act{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap }
    .btn{ border:none; border-radius:999px; padding:10px 12px; font-weight:800; cursor:pointer }
    .btn.primary{ background:var(--forest); color:#fff }
    .btn.secondary{ background:#fff; border:1px solid var(--line) }
    .btn.ghost{ background:transparent; border:1px dashed var(--line) }

    .challenge{ border:1px solid var(--line); border-radius:12px; padding:10px; display:grid; gap:8px }
    .challenge .row{ display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap }
    .pill{ display:inline-flex; align-items:center; gap:6px; border-radius:999px; padding:6px 10px; background:#f2f7f4; border:1px solid var(--line); font-size:.82rem }
    .streak{ font-weight:900; color:#forest }

    .feed{ display:grid; gap:8px }
    .note{ border-left:4px solid var(--forest); background:#f7fbf8; border:1px solid var(--line); padding:10px; border-radius:8px }

    /* Badges (now in the right column position) */
    .badges{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px }
    @media(max-width:700px){ .badges{ grid-template-columns:repeat(3,1fr) } }
    .badge{ display:grid; place-items:center; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff; text-align:center }
    .badge .icon{ font-size:26px; display:grid; place-items:center }
    .badge .label{ font-size:.82rem; margin-top:6px }
    .badge.locked{ opacity:.5; filter:grayscale(1) }

    /* Footer dock */
    .dock{ position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid var(--line); display:flex; gap:8px; flex-wrap:wrap; justify-content:center; padding:10px }
    .dock .btn{ padding:10px 14px }

    /* Utility */
    .span-2{ grid-column:1 / -1; }

    /* A11y helpers */
    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* ===== Popover styles (re-used) ===== */
    .calc-head{ display:flex; align-items:center; gap:8px; position:relative; }
    .help-trigger{
      display:inline-grid; place-items:center; width:24px; height:24px; border-radius:999px;
      border:1px solid var(--line); background:#fff; color:#0e1f17; font-weight:900; line-height:1; cursor:pointer;
    }
    .help-trigger:focus-visible{ outline:2px solid var(--gold); outline-offset:2px; }
    .help-pop{
      position:absolute; top:100%; right:0; margin-top:8px; z-index:10;
      background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:0 12px 28px rgba(0,0,0,.12);
      padding:12px; width:min(480px, 92vw);
    }
    .help-pop h4{ margin:0 0 6px; font-size:.98rem; }
    .help-pop p{ margin:.4rem 0; color:#51635b; }
    .help-pop .close{
      margin-top:10px; display:inline-flex; align-items:center; gap:6px;
      border:1px solid var(--line); background:#fff; border-radius:999px; padding:6px 10px; cursor:pointer; font-weight:700;
    }
    @media (max-width:560px){ .help-pop{ right:auto; left:0; } }

    /* ===== New form styling (Workish colors, investor.gov layout vibe) ===== */
    .iwrap{ border:1px solid var(--line); border-radius:12px; overflow:hidden }
    .istep-head{
      background:#2a6d57; color:#fff; font-weight:900; padding:10px 12px;
      border-top:1px solid rgba(0,0,0,.06);
    }
    .istep{
      background:#0f2a1b; color:#fff; display:grid; grid-template-columns:1fr auto;
      gap:10px; padding:14px 12px; align-items:center; border-bottom:1px solid rgba(255,255,255,.15);
    }
    .istep .label{ font-weight:900 }
    .istep .hint{ font-size:.9rem; color:#eaf3ee; margin-top:4px }
    .istep input, .istep select{
      width:220px; max-width:100%; padding:10px; border-radius:8px; border:1px solid #dfe7e3; color:#0f2a1b;
      background:#fff;
    }
    .i-actions{
      background:#fff; display:flex; gap:10px; justify-content:flex-end; padding:12px; border-top:1px solid var(--line);
    }
    .btn.calc{ background:#d24b00; color:#fff; border:none; border-radius:10px; padding:12px 16px; font-weight:900; cursor:pointer }
    .btn.reset{ background:#0b6d3d; color:#fff; border:none; border-radius:10px; padding:12px 16px; font-weight:900; cursor:pointer }

    .result-grid{
      display:grid; gap:10px; grid-template-columns:repeat(3,1fr); margin-top:12px;
    }
    .res-card{ background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px }
    .res-card .big{ font-weight:900; color:var(--forest); font-size:1.2rem }
    .res-card .sub{ color:#51635b; font-size:.9rem }

    .rates-table{ width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border:1px solid var(--line); border-radius:10px; margin-top:10px; background:#fff }
    .rates-table th, .rates-table td{ padding:10px; border-bottom:1px solid var(--line); text-align:right }
    .rates-table th{ background:#f7fbf8; text-align:left }
    .rates-table tr:last-child td{ border-bottom:none }
  </style>
</head>
<body>

  <!-- Header (logo + menus) -->
  <header class="site-header" role="banner">
    <div class="nav-wrap">
      <a class="nav-brand" href="/index.html" aria-label="Workish Home">
        <img src="/images/worklogo.PNG" alt="Workish" class="nav-logo">
      </a>

      <nav class="nav-main" aria-label="Primary">
        <div class="nav-item has-submenu"></div>

        <div class="nav-item has-submenu">
          <button class="nav-link" aria-haspopup="true" aria-expanded="false">Join Workish</button>
          <div class="submenu">
            <a href="/taskers.html">For Taskers & Parents</a>
            <a href="/customers.html">For Customers</a>
            <a href="/safety.html">Safety & Oversight</a>
          </div>
        </div>
        <div class="nav-item has-submenu">
          <button class="nav-link" aria-haspopup="true" aria-expanded="false">About</button>
          <div class="submenu">
            <a href="/mission.html">Mission</a>
            <a href="/trust.html">Trust & verification</a>
            <a href="/faq.html">FAQ</a>
          </div>
        </div>
        <div class="nav-item has-submenu">
          <button class="nav-link" aria-haspopup="true" aria-expanded="false">Workish Wallet üí∞</button>
          <div class="submenu">
            <a href="/wallet.html">Save with Workish</a>
          </div>
        </div>
      </nav>

      <button class="nav-burger" id="navBurger" aria-label="Open menu" aria-controls="mobilePanel" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div id="mobilePanel" class="mobile-panel" hidden>
      <details class="m-item"><summary>Join Workish</summary>
        <a href="/taskers.html">For Taskers & Parents</a>
        <a href="/customers.html">For Customers</a>
        <a href="/safety.html">Safety & Oversight</a>
      </details>
      <details class="m-item"><summary>About</summary>
        <a href="/mission.html">Mission</a>
        <a href="/trust.html">Trust & Verification</a>
        <a href="/faq.html">FAQ</a>
      </details>
       <details class="m-item"><summary>Workish Wallet üí∞</summary>
        <a href="/wallet.html">Save with Workish</a>
      </details>
    </div>
  </header>
  
      <button class="nav-burger" id="navBurger" aria-label="Open menu" aria-controls="mobilePanel" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div id="mobilePanel" class="mobile-panel" hidden>
      <details class="m-item"><summary>Join Workish</summary>
        <a href="/taskers.html">For Taskers & Parents</a>
        <a href="/customers.html">For Customers</a>
        <a href="/safety.html">Safety & Oversight</a>
      </details>
      <details class="m-item"><summary>Why Workish</summary>
        <a href="/about.html#mission">Mission</a>
        <a href="/about.html#trust">Trust & Verification</a>
        <a href="/about.html#faq">FAQ</a>
      </details>
      <details class="m-item"><summary>What‚Äôs new</summary>
        <a href="/updates.html#pilot-news">Pilot updates</a>
        <a href="/updates.html#roadmap">Roadmap</a>
        <a href="/updates.html#changelog">Changelog</a>
      </details>
       <details class="m-item"><summary>Workish Wallet üí∞</summary>
        <a href="/wallet.html">Save with Workish</a>
      </details>
    </div>
  </header>

  <!-- Main -->
  <main class="shell">
    <section class="hero" aria-label="Intro">
      <h1>Workish Wallet</h1>
      <p>Build habits, grow savings, learn real-world money skills.</p>
      <div class="cta-row">
        <a class="apply" href="/login.html">Login / Create Account ‚Üí</a>
        <a class="apply" href="/taskers.html">Become a Tasker ‚Üí</a>
      </div>
    </section>

    <section class="grid" aria-label="Wallet dashboard">
      <!-- Left: balances -->
      <div class="card">
        <h3>Balances</h3>
        <div class="balances" id="balances"></div>
        <div class="level">
          <div><strong>Level</strong> <span id="levelNum" class="num">1</span></div>
          <div class="barwrap"><div id="levelBar" class="bar"></div></div>
        </div>
      </div>

      <!-- Right: BADGES now lives here (moved up) -->
      <div class="card">
        <h3>Badges</h3>
        <div class="badges" id="badges"></div>
      </div>

      <!-- Row 2 -->
      <div class="card">
        <h3>Savings Goals</h3>
        <div class="goals" id="goals"></div>
        <button class="btn ghost" id="addGoal" style="margin-top:10px">+ Add goal</button>
      </div>

      <div class="card">
        <h3>Challenges & Streaks</h3>
        <div class="challenge">
          <div class="row">
            <div><strong>Weekly Saver</strong> ‚Äî save at least <em>$10</em> this week</div>
            <span class="pill">Streak: <span class="streak" id="streakNum">0</span> weeks</span>
          </div>
          <div class="row">
            <div class="note" id="streakStatus">No activity yet</div>
            <button class="btn primary" id="logWeeklySave">$10 Quick-Save</button>
          </div>
        </div>
        <div class="challenge" style="margin-top:10px">
          <div class="row">
            <div><strong>Give-Back</strong> ‚Äî donate <em>5%</em> of a payout</div>
            <span class="pill" id="donateBadge">Locked</span>
          </div>
          <div class="row">
            <div class="note">Choose an amount to donate from the dock actions.</div>
            <button class="btn secondary" id="openDonate">Donate‚Ä¶</button>
          </div>
        </div>
      </div>

      <!-- Row 3: Insights spans both columns -->
      <div class="card span-2">
        <h3>Earnings Insights</h3>
        <div class="feed" id="feed"></div>
      </div>

      <!-- Row 4: NEW Investment Form (replaces prior calculator) -->
      <div class="card span-2" aria-label="Investment calculator">
        <h3 class="calc-head">
          Investment Growth Estimator
          <button id="ciHelp" class="help-trigger" aria-haspopup="dialog" aria-expanded="false" aria-controls="ciPop" title="Learn more">?</button>
        </h3>

        <!-- Learn more: Compound interest -->
        <div id="ciPop" class="help-pop" role="dialog" aria-modal="false" aria-labelledby="ciTitle" hidden>
          <h4 id="ciTitle">What is compound interest?</h4>
          <p><strong>Compound interest</strong> means you earn interest on your contributions <em>and</em> on the interest already earned‚Äîso the balance can grow faster over time.</p>
          <p>Compounding frequency (daily, monthly, etc.) controls how often interest is added. More frequent compounding makes a small but positive difference.</p>
          <button class="close" id="ciClose" aria-label="Close">Close</button>
        </div>

        <div class="iwrap" id="invForm">
          <!-- Step 1 -->
          <div class="istep-head">Step 1: Initial Investment</div>
          <div class="istep">
            <div>
              <div class="label">Initial Investment <span aria-hidden="true" style="color:#ffd66b">*</span></div>
              <div class="hint">Amount of money that you have available to invest initially.</div>
            </div>
            <input id="i_initial" type="number" min="0" step="1" value="0" aria-label="Initial Investment">
          </div>

          <!-- Step 2 -->
          <div class="istep-head">Step 2: Contribute</div>
          <div class="istep">
            <div>
              <div class="label">Monthly Contribution</div>
              <div class="hint">Amount that you plan to add every month (use a negative number to withdraw monthly).</div>
            </div>
            <input id="i_monthly" type="number" step="1" value="200" aria-label="Monthly Contribution">
          </div>
          <div class="istep">
            <div>
              <div class="label">Length of Time in Years <span aria-hidden="true" style="color:#ffd66b">*</span></div>
              <div class="hint">Length of time, in years, that you plan to save.</div>
            </div>
            <input id="i_years" type="number" min="1" step="1" value="10" aria-label="Length of Time in Years">
          </div>

          <!-- Step 3 -->
          <div class="istep-head">Step 3: Interest Rate</div>
          <div class="istep">
            <div>
              <div class="label">Estimated Interest Rate <span aria-hidden="true" style="color:#ffd66b">*</span></div>
              <div class="hint">Your estimated annual rate of return (APR).</div>
            </div>
            <input id="i_rate" type="number" min="0" step="0.1" value="7" aria-label="Estimated Interest Rate">
          </div>
          <div class="istep">
            <div>
              <div class="label">Interest Rate Variance Range</div>
              <div class="hint">Range above and below your rate to compare (e.g., 2 shows results for rate¬±2%).</div>
            </div>
            <input id="i_var" type="number" min="0" step="0.1" value="2" aria-label="Interest Rate Variance Range">
          </div>

          <!-- Step 4 -->
          <div class="istep-head">Step 4: Compound It</div>
          <div class="istep" style="border-bottom:none">
            <div>
              <div class="label">Compound Frequency</div>
              <div class="hint">Times per year interest is compounded.</div>
            </div>
            <select id="i_freq" aria-label="Compound Frequency">
              <option value="1">Annually</option>
              <option value="2">Semiannually</option>
              <option value="4">Quarterly</option>
              <option value="12" selected>Monthly</option>
              <option value="365">Daily</option>
            </select>
          </div>

          <div class="i-actions">
            <button class="btn calc" id="i_calc">CALCULATE</button>
            <button class="btn reset" id="i_reset">RESET</button>
          </div>
        </div>

        <!-- Results -->
        <div class="result-grid" id="i_results" style="display:none">
          <div class="res-card">
            <div class="label">Future Value</div>
            <div class="big" id="r_fv">$0</div>
            <div class="sub">Projected balance</div>
          </div>
          <div class="res-card">
            <div class="label">Total Contributions</div>
            <div class="big" id="r_contrib">$0</div>
            <div class="sub">Initial + monthly deposits</div>
          </div>
          <div class="res-card">
            <div class="label">Total Growth</div>
            <div class="big" id="r_growth">$0</div>
            <div class="sub">Future value minus contributions</div>
          </div>
        </div>

        <table class="rates-table" id="i_rate_table" style="display:none">
          <thead>
            <tr>
              <th>Scenario</th>
              <th style="text-align:right">Rate</th>
              <th style="text-align:right">Future Value</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Lower</td><td id="rt_lo"></td><td id="fv_lo"></td></tr>
            <tr><td>Base</td><td id="rt_md"></td><td id="fv_md"></td></tr>
            <tr><td>Higher</td><td id="rt_hi"></td><td id="fv_hi"></td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modals -->
  <dialog id="goalModal">
    <form method="dialog" class="card" style="padding:14px; max-width:520px">
      <h3>New Goal</h3>
      <label class="sr-only" for="goalName">Goal name</label>
      <input id="goalName" name="goalName" placeholder="e.g., New guitar" style="width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);margin-bottom:8px" required />
      <div style="display:flex;gap:8px">
        <div style="flex:1">
          <label class="sr-only" for="goalTarget">Target amount</label>
          <input id="goalTarget" name="goalTarget" type="number" min="1" step="1" placeholder="Target $" style="width:100%;padding:10px;border-radius:12px;border:1px solid var(--line)" required />
        </div>
        <div style="flex:1">
          <label class="sr-only" for="goalSeed">Seed from balance</label>
          <input id="goalSeed" name="goalSeed" type="number" min="0" step="1" placeholder="Seed $" style="width:100%;padding:10px;border-radius:12px;border:1px solid var(--line)" />
        </div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn secondary" value="cancel" type="submit">Cancel</button>
        <button class="btn primary" value="ok" type="submit">Create</button>
      </div>
    </form>
  </dialog>

  <dialog id="donateModal">
    <form method="dialog" class="card" style="padding:14px; max-width:520px">
      <h3>Donate from Available Balance</h3>
      <div class="note">Pick an amount. For demo purposes, this only affects badges/insights.</div>
      <input id="donateAmt" type="number" min="1" step="1" value="5" style="width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);margin-top:8px"/>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button class="btn secondary" value="cancel" type="submit">Cancel</button>
        <button class="btn primary" value="ok" type="submit">Donate</button>
      </div>
    </form>
  </dialog>

  <!-- Action Dock (simulate jobs/payouts/saving) -->
  <div class="dock">
    <button class="btn secondary" id="simulateJob">$60 ‚Äî Complete Job</button>
    <button class="btn secondary" id="payout">$50 ‚Äî Payout to Wallet</button>
    <button class="btn secondary" id="save20">Save $20 ‚Üí Top Goal</button>
    <button class="btn secondary" id="spend15">Spend $15</button>
    <button class="btn primary" id="quickTip">+ Tip $5</button>
  </div>

  <script>
    // ===== Mobile panel toggle (same shell behavior) =====
    const burger=document.getElementById('navBurger');
    const panel=document.getElementById('mobilePanel');
    if(burger&&panel){
      burger.addEventListener('click',()=>{
        const open=panel.hasAttribute('hidden');
        if(open) panel.removeAttribute('hidden'); else panel.setAttribute('hidden','');
        burger.setAttribute('aria-expanded', String(open));
      });
    }
    document.querySelectorAll('.has-submenu .nav-link').forEach(btn=>{
      const menu=btn.parentElement.querySelector('.submenu');
      btn.addEventListener('click',e=>{
        const visible = menu && menu.style.display==='block';
        document.querySelectorAll('.submenu').forEach(m=>m.style.display='none');
        if(menu) menu.style.display = visible ? 'none' : 'block';
        btn.setAttribute('aria-expanded', String(!visible));
        e.stopPropagation();
      });
    });
    document.addEventListener('click',()=>{
      document.querySelectorAll('.submenu').forEach(m=>m.style.display='none');
      document.querySelectorAll('.has-submenu .nav-link').forEach(b=>b.setAttribute('aria-expanded','false'));
    });

    // ===== Wallet State & Helpers =====
    const defaultState = {
      balanceAvailable: 0,
      pendingPayouts: 0,
      totalEarned: 0,
      savedTotal: 0,
      donatedTotal: 0,
      goals: [
        { id: 'g1', name: 'AirPods', target: 150, saved: 40 },
        { id: 'g2', name: 'Bike Fund', target: 300, saved: 90 }
      ],
      badges: {
        firstJob: false,
        hundredSaved: false,
        tenJobs: false,
        communityHero: false,
        goalCrusher: false,
        goalSetter: false
      },
      jobsCompleted: 0,
      levelXP: 0,
      level: 1,
      weeklyStreak: 0,
      lastStreakWeek: null,
      feed: [
        { t: Date.now(), msg: 'Welcome! Finish a job and start your streak.' }
      ]
    };

    function loadState(){
      const raw = localStorage.getItem('workish_wallet_demo_v3');
      if(!raw) return { ...defaultState };
      try { return JSON.parse(raw); } catch { return { ...defaultState }; }
    }
    function saveState(){ localStorage.setItem('workish_wallet_demo_v3', JSON.stringify(state)); }
    function addFeed(msg){ state.feed.unshift({ t: Date.now(), msg }); if(state.feed.length>25) state.feed.pop(); }
    function fmt(n){ return '$' + n.toLocaleString(undefined,{maximumFractionDigits:0}); }
    function weekOf(ts){ const d=new Date(ts); const first=new Date(d.getFullYear(),0,1); return Math.floor((d-first)/(1000*60*60*24*7)); }

    // ===== Rendering (unchanged from prior sections) =====
    function renderBalances(){
      const balances = document.getElementById('balances');
      balances.innerHTML = '';
      const items = [
        { label: 'Available', val: state.balanceAvailable, sub: 'Spendable' },
        { label: 'Pending', val: state.pendingPayouts, sub: 'Payouts due' },
        { label: 'Saved', val: state.savedTotal, sub: 'Across goals' },
        { label: 'Total Earned', val: state.totalEarned, sub: 'All time' },
      ];
      items.forEach(it => {
        const el = document.createElement('div');
        el.className = 'kpi';
        el.innerHTML = `
          <div class="label">${it.label}</div>
          <div class="val">${fmt(it.val)}</div>
          <div class="sub">${it.sub}</div>
        `;
        balances.appendChild(el);
      });
      document.getElementById('levelNum').textContent = state.level;
      document.getElementById('levelBar').style.width = Math.min(100, state.levelXP) + '%';
    }

    function renderGoals(){
      const wrap = document.getElementById('goals');
      wrap.innerHTML = '';
      if(state.goals.length === 0){
        const empty = document.createElement('div');
        empty.className = 'note';
        empty.textContent = 'No goals yet. Add your first goal to start saving!';
        wrap.appendChild(empty);
      }
      state.goals.forEach(g => {
        const pct = Math.min(100, (g.saved / g.target) * 100);
        const el = document.createElement('div');
        el.className = 'goal';
        el.innerHTML = `
          <div class="top">
            <div class="name">${g.name}</div>
            <div class="note">${fmt(g.saved)} / ${fmt(g.target)}</div>
          </div>
          <div class="progress"><div class="bar" style="width:${pct}%"></div></div>
          <div class="meta"><span>${pct.toFixed(0)}% funded</span><span>Goal ID: ${g.id}</span></div>
          <div class="act">
            <button class="btn secondary" data-act="add" data-id="${g.id}">+ Save $10</button>
            <button class="btn secondary" data-act="save20" data-id="${g.id}">+ Save $20</button>
            <button class="btn ghost" data-act="edit" data-id="${g.id}">Edit</button>
            <button class="btn ghost" data-act="delete" data-id="${g.id}">Delete</button>
          </div>
        `;
        el.querySelectorAll('button').forEach(b=> b.addEventListener('click', onGoalAction));
        wrap.appendChild(el);
      });
    }

    function badgeIconSVG(kind){
      if(kind==='goalSetter'){
        return `
          <svg width="28" height="28" viewBox="0 0 48 48" aria-hidden="true">
            <circle cx="24" cy="24" r="22" fill="#fff7e0" stroke="#e6c24a"/>
            <circle cx="24" cy="24" r="10" fill="#ffd66b" stroke="#b5962e"/>
            <line x1="24" y1="6" x2="24" y2="10" stroke="#b5962e" stroke-width="2"/>
            <line x1="24" y1="38" x2="24" y2="42" stroke="#b5962e" stroke-width="2"/>
            <line x1="6" y1="24" x2="10" y2="24" stroke="#b5962e" stroke-width="2"/>
            <line x1="38" y1="24" x2="42" y2="24" stroke="#b5962e" stroke-width="2"/>
            <circle cx="24" cy="24" r="4" fill="#003924"/>
          </svg>`;
      }
      const map = { firstJob:'üíº', hundredSaved:'üè¶', tenJobs:'üîü', communityHero:'ü§ù', goalCrusher:'üéØ' };
      const emo = map[kind] || '‚≠ê';
      return `<span style="font-size:26px;line-height:1">${emo}</span>`;
    }

    function renderBadges(){
      const all = [
        { key:'firstJob', label:'First Job' },
        { key:'hundredSaved', label:'$100 Saved' },
        { key:'tenJobs', label:'10 Jobs' },
        { key:'communityHero', label:'Community Hero' },
        { key:'goalCrusher', label:'Goal Crusher' },
        { key:'goalSetter', label:'Goal Setter' }
      ];
      const wrap = document.getElementById('badges');
      wrap.innerHTML = '';
      all.forEach(b=>{
        const el = document.createElement('div');
        el.className = 'badge' + (state.badges[b.key] ? '' : ' locked');
        el.innerHTML = `<div class="icon">${badgeIconSVG(b.key)}</div><div class="label">${b.label}</div>`;
        wrap.appendChild(el);
      });
    }

    function renderFeed(){
      const wrap = document.getElementById('feed');
      wrap.innerHTML = '';
      state.feed.forEach(item=>{
        const el = document.createElement('div');
        el.className = 'note';
        const d = new Date(item.t);
        el.textContent = `[${d.toLocaleString()}] ${item.msg}`;
        wrap.appendChild(el);
      });
    }

    function renderStreak(){
      document.getElementById('streakNum').textContent = state.weeklyStreak;
      const wk = weekOf(Date.now());
      const status = (state.lastStreakWeek === wk) ? 'Great! You saved this week.' :
                     (state.lastStreakWeek === wk-1) ? 'Keep it up ‚Äî save once this week to continue your streak.' :
                     'No activity yet';
      document.getElementById('streakStatus').textContent = status;
      const donateBadge = document.getElementById('donateBadge');
      donateBadge.textContent = state.badges.communityHero ? 'Unlocked' : 'Locked';
    }

    function renderAll(){
      renderBalances();
      renderGoals();
      renderBadges();
      renderFeed();
      renderStreak();
      saveState();
    }

    // Goal actions
    function onGoalAction(e){
      const id = e.currentTarget.getAttribute('data-id');
      const act = e.currentTarget.getAttribute('data-act');
      const g = state.goals.find(x=>x.id===id);
      if(!g) return;
      if(act === 'delete'){
        if(confirm('Delete goal "'+g.name+'"?')){
          state.goals = state.goals.filter(x=>x.id!==id);
          renderAll();
        }
        return;
      }
      if(act === 'edit'){
        const newName = prompt('Rename goal:', g.name) ?? g.name;
        const newTarget = Number(prompt('New target $:', g.target) ?? g.target);
        if(newTarget>0){
          g.name = newName; g.target = newTarget;
          if(g.saved > g.target) g.saved = g.target;
          renderAll();
        }
        return;
      }
      if(act === 'add' || act === 'save20'){
        const amt = (act==='add') ? 10 : 20;
        if(state.balanceAvailable < amt){ alert('Not enough available balance.'); return; }
        state.balanceAvailable -= amt;
        g.saved += amt;
        state.savedTotal += amt;
        addFeed('Saved '+fmt(amt)+' toward "'+g.name+'".');
        if(!state.badges.hundredSaved && state.savedTotal >= 100){
          state.badges.hundredSaved = true; addFeed('Badge unlocked: $100 Saved üè¶');
        }
        if(g.saved >= g.target && !state.badges.goalCrusher){
          state.badges.goalCrusher = true; addFeed('Goal "'+g.name+'" completed! Badge unlocked: Goal Crusher üéØ');
        }
        renderAll();
      }
    }

    // ===== Init dashboard =====
    let state = loadState();
    renderAll();

    // ===== Investment math (base + variance, with compounding frequency) =====
    function money(n){ return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); }

    // Effective monthly rate from APR and compounding freq m (times/year)
    function monthlyRate(apr, m){
      const r = apr/100;
      return Math.pow(1 + r/m, m/12) - 1;
    }

    function computeFV({initial, monthly, years, apr, m}){
      const months = Math.max(0, Math.floor(years*12));
      const r_m = monthlyRate(apr, m);
      let bal = initial;
      let totalContrib = initial;
      for(let i=0;i<months;i++){
        bal = bal * (1 + r_m) + monthly;
        totalContrib += monthly;
      }
      return { fv: bal, contrib: totalContrib, growth: bal - totalContrib };
    }

    function runInvestment(){
      const initial = Number(document.getElementById('i_initial').value || 0);
      const monthly = Number(document.getElementById('i_monthly').value || 0);
      const years   = Number(document.getElementById('i_years').value || 0);
      const apr     = Number(document.getElementById('i_rate').value || 0);
      const variance= Number(document.getElementById('i_var').value || 0);
      const m       = Number(document.getElementById('i_freq').value || 12);

      const base = computeFV({initial, monthly, years, apr, m});
      document.getElementById('r_fv').textContent = money(base.fv);
      document.getElementById('r_contrib').textContent = money(base.contrib);
      document.getElementById('r_growth').textContent = money(base.growth);
      document.getElementById('i_results').style.display = 'grid';

      // Variance table
      const loRate = Math.max(0, apr - variance);
      const hiRate = apr + variance;
      const lo = computeFV({initial, monthly, years, apr: loRate, m});
      const md = base;
      const hi = computeFV({initial, monthly, years, apr: hiRate, m});

      document.getElementById('rt_lo').textContent = loRate.toFixed(1) + '%';
      document.getElementById('rt_md').textContent = apr.toFixed(1) + '%';
      document.getElementById('rt_hi').textContent = hiRate.toFixed(1) + '%';
      document.getElementById('fv_lo').textContent = money(lo.fv);
      document.getElementById('fv_md').textContent = money(md.fv);
      document.getElementById('fv_hi').textContent = money(hi.fv);
      document.getElementById('i_rate_table').style.display = '';
    }

    document.getElementById('i_calc').addEventListener('click', (e)=>{ e.preventDefault(); runInvestment(); });
    document.getElementById('i_reset').addEventListener('click', (e)=>{
      e.preventDefault();
      document.getElementById('i_initial').value = 0;
      document.getElementById('i_monthly').value = 200;
      document.getElementById('i_years').value = 10;
      document.getElementById('i_rate').value = 7;
      document.getElementById('i_var').value = 2;
      document.getElementById('i_freq').value = "12";
      document.getElementById('i_results').style.display = 'none';
      document.getElementById('i_rate_table').style.display = 'none';
    });

    // ===== Learn more popover behavior =====
    (function(){
      const trigger = document.getElementById('ciHelp');
      const pop = document.getElementById('ciPop');
      const closeBtn = document.getElementById('ciClose');
      if(!trigger || !pop) return;

      function openPop(){
        pop.hidden = false;
        trigger.setAttribute('aria-expanded','true');
        closeBtn && closeBtn.focus();
      }
      function closePop(){
        if(pop.hidden) return;
        pop.hidden = true;
        trigger.setAttribute('aria-expanded','false');
        trigger.focus();
      }
      trigger.addEventListener('click', (e)=>{ e.stopPropagation(); pop.hidden ? openPop() : closePop(); });
      closeBtn && closeBtn.addEventListener('click', (e)=>{ e.preventDefault(); closePop(); });
      document.addEventListener('click', (e)=>{ if(pop.hidden) return; if(!(pop.contains(e.target)||trigger.contains(e.target))) closePop(); });
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closePop(); });
    })();
  </script>
</body>
</html>
